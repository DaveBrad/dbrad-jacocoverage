/* Copyright (c) 2017 dbradley. All rights reserved. */
package dbrad.jacocoverage.plugin.config.gen;

import dbrad.jacocofpm.config.IdeProjectJacocoverageConfig;
import dbrad.jacocoverage.plugin.config.projconfig.PrjcfgAntJavasePanel;
import java.awt.Color;
import java.awt.Component;
import java.awt.Font;
import java.io.File;
import javax.swing.JCheckBox;
import javax.swing.JFileChooser;
import javax.swing.JRadioButton;
import javax.swing.SpinnerNumberModel;
import javax.swing.border.LineBorder;
import javax.swing.border.TitledBorder;

/**
 * Class for the general-tab inner-GUI for the save-files settings for report
 * directory locations and time-stamp controls.
 * 
 * @author dbradley
 */
public class jPanelGeneralSaveFiles extends javax.swing.JPanel {

    private static final long serialVersionUID = 0L;

    private static final Font DEFAULT_LABEL_FONT = new Font("SansSerif", Font.ITALIC, 12);

    PrjcfgAntJavasePanel prgCfgJavasePanel;

    /**
     * Creates new form jPanelGeneralOptions
     */
    public jPanelGeneralSaveFiles() {
        initComponents();
    }

    public void setJavaSePanel(PrjcfgAntJavasePanel prgCfgJavasePanel) {
        this.prgCfgJavasePanel = prgCfgJavasePanel;
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        buttonGroup1 = new javax.swing.ButtonGroup();
        jPanel1 = new javax.swing.JPanel();
        jButtonBrowseFileChooser = new javax.swing.JButton();
        jTextfieldUserDefinedDirectory = new javax.swing.JTextField();
        jRadioButtUserDefinedDirectory = new javax.swing.JRadioButton();
        jLabelDefaultDir = new javax.swing.JLabel();
        jRadioButtDefaultReportDirectory = new javax.swing.JRadioButton();
        jPanel2 = new javax.swing.JPanel();
        timeStampedReports = new javax.swing.JCheckBox();
        jLabel1 = new javax.swing.JLabel();
        jSpinnerRetainReports = new javax.swing.JSpinner();

        setPreferredSize(new java.awt.Dimension(700, 250));
        setVerifyInputWhenFocusTarget(false);

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(null, org.openide.util.NbBundle.getMessage(jPanelGeneralSaveFiles.class, "jPanelGeneralSaveFiles.jPanel1.border.title"), javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("SansSerif", 2, 10))); // NOI18N
        jPanel1.setFont(new java.awt.Font("Tahoma", 2, 10)); // NOI18N

        org.openide.awt.Mnemonics.setLocalizedText(jButtonBrowseFileChooser, org.openide.util.NbBundle.getMessage(jPanelGeneralSaveFiles.class, "jPanelGeneralSaveFiles.jButtonBrowseFileChooser.text")); // NOI18N
        jButtonBrowseFileChooser.setEnabled(false);
        jButtonBrowseFileChooser.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonBrowseFileChooserActionPerformed(evt);
            }
        });

        jTextfieldUserDefinedDirectory.setText(org.openide.util.NbBundle.getMessage(jPanelGeneralSaveFiles.class, "jPanelGeneralSaveFiles.jTextfieldUserDefinedDirectory.text")); // NOI18N
        jTextfieldUserDefinedDirectory.setEnabled(false);

        buttonGroup1.add(jRadioButtUserDefinedDirectory);
        org.openide.awt.Mnemonics.setLocalizedText(jRadioButtUserDefinedDirectory, org.openide.util.NbBundle.getMessage(jPanelGeneralSaveFiles.class, "jPanelGeneralSaveFiles.jRadioButtUserDefinedDirectory.text")); // NOI18N
        jRadioButtUserDefinedDirectory.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jRadioButtUserDefinedDirectoryActionPerformed(evt);
            }
        });

        org.openide.awt.Mnemonics.setLocalizedText(jLabelDefaultDir, org.openide.util.NbBundle.getMessage(jPanelGeneralSaveFiles.class, "jPanelGeneralSaveFiles.jLabelDefaultDir.text")); // NOI18N

        buttonGroup1.add(jRadioButtDefaultReportDirectory);
        jRadioButtDefaultReportDirectory.setSelected(true);
        org.openide.awt.Mnemonics.setLocalizedText(jRadioButtDefaultReportDirectory, org.openide.util.NbBundle.getMessage(jPanelGeneralSaveFiles.class, "jPanelGeneralSaveFiles.jRadioButtDefaultReportDirectory.text")); // NOI18N
        jRadioButtDefaultReportDirectory.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jRadioButtDefaultReportDirectoryActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addComponent(jRadioButtDefaultReportDirectory)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabelDefaultDir, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jRadioButtUserDefinedDirectory)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jTextfieldUserDefinedDirectory)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jButtonBrowseFileChooser))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jRadioButtUserDefinedDirectory)
                    .addComponent(jRadioButtDefaultReportDirectory)
                    .addComponent(jLabelDefaultDir))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jTextfieldUserDefinedDirectory, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jButtonBrowseFileChooser))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jTextfieldUserDefinedDirectory.setText(IdeProjectJacocoverageConfig.JACOCOVERAGE_DATA_ROOTDIR);
        jLabelDefaultDir.setText("(" + IdeProjectJacocoverageConfig.JACOCOVERAGE_DATA_ROOTDIR + ")");
        jLabelDefaultDir.setFont(DEFAULT_LABEL_FONT);

        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder(null, org.openide.util.NbBundle.getMessage(jPanelGeneralSaveFiles.class, "jPanelGeneralSaveFiles.jPanel2.border.title"), javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("SansSerif", 2, 10))); // NOI18N

        org.openide.awt.Mnemonics.setLocalizedText(timeStampedReports, org.openide.util.NbBundle.getMessage(jPanelGeneralSaveFiles.class, "jPanelGeneralSaveFiles.timeStampedReports.text")); // NOI18N
        timeStampedReports.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                timeStampedReportsActionPerformed(evt);
            }
        });

        org.openide.awt.Mnemonics.setLocalizedText(jLabel1, org.openide.util.NbBundle.getMessage(jPanelGeneralSaveFiles.class, "jPanelGeneralSaveFiles.jLabel1.text")); // NOI18N

        jSpinnerRetainReports.setEnabled(false);
        jSpinnerRetainReports.setMaximumSize(new java.awt.Dimension(29, 25));
        jSpinnerRetainReports.setMinimumSize(new java.awt.Dimension(29, 25));
        jSpinnerRetainReports.setName(""); // NOI18N
        jSpinnerRetainReports.setPreferredSize(new java.awt.Dimension(29, 25));
        jSpinnerRetainReports.setValue(3);
        jSpinnerRetainReports.addChangeListener(new javax.swing.event.ChangeListener() {
            public void stateChanged(javax.swing.event.ChangeEvent evt) {
                jSpinnerRetainReportsStateChanged(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addComponent(timeStampedReports)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jSpinnerRetainReports, javax.swing.GroupLayout.PREFERRED_SIZE, 41, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel1)
                .addGap(0, 224, Short.MAX_VALUE))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(timeStampedReports)
                    .addComponent(jSpinnerRetainReports, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel1))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        SpinnerNumberModel numModel = new SpinnerNumberModel(0, 0, 99, 1);
        jSpinnerRetainReports.setModel(numModel);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, 83, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, 56, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(103, Short.MAX_VALUE))
        );

        TitledBorder jp1brdr = (TitledBorder)jPanel1.getBorder();
        jp1brdr.setBorder(new LineBorder(Color.black, 1));
        TitledBorder jp2brdr = (TitledBorder)jPanel2.getBorder();
        jp2brdr.setBorder(new LineBorder(Color.black, 1));
    }// </editor-fold>//GEN-END:initComponents

    private void storeOnAction() {
        // have a dependency loop in that these controls are set during loading and we are
        // attempting to set them while loading
        this.prgCfgJavasePanel.store();
    }

    private void jButtonBrowseFileChooserActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonBrowseFileChooserActionPerformed
        // need the file chooser to launch for selecting a directory
        // and as close as possible to the action-performed location
        JFileChooser chooser;

        String fileLocation = jTextfieldUserDefinedDirectory.getText();
        if (fileLocation.equals(IdeProjectJacocoverageConfig.JACOCOVERAGE_DATA_ROOTDIR)) {
            chooser = new JFileChooser();
        } else {
            chooser = new JFileChooser(fileLocation);
        }

        chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
        chooser.showOpenDialog((Component) evt.getSource());

        // if the  dir is selected then set the jtextField needs to be set
        File dirFromChooser = chooser.getSelectedFile();
        if (dirFromChooser != null) {
            jTextfieldUserDefinedDirectory.setText(dirFromChooser.getAbsolutePath().replaceAll("\\\\", "/"));

            storeOnAction();
        } else {
            // revert to default settings if a null selection only if
            // the text-field not the default
            fileLocation = jTextfieldUserDefinedDirectory.getText();

            if (fileLocation.equals(IdeProjectJacocoverageConfig.JACOCOVERAGE_DATA_ROOTDIR)) {
                this.jRadioButtDefaultReportDirectory.setSelected(true);
                this.jRadioButtUserDefinedDirectory.setSelected(false);
            }
        }
    }//GEN-LAST:event_jButtonBrowseFileChooserActionPerformed

    
    public void enablejRadioButtDefaultReportDirectory(JRadioButton defaultButt){
        
         boolean state = defaultButt.isSelected();
         
         this.jTextfieldUserDefinedDirectory.setEnabled(!state);
        this.jButtonBrowseFileChooser.setEnabled(!state);
    }
    
    
    private void jRadioButtDefaultReportDirectoryActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jRadioButtDefaultReportDirectoryActionPerformed

        JRadioButton defaultButt = (JRadioButton) evt.getSource();        
        enablejRadioButtDefaultReportDirectory(defaultButt);

        storeOnAction();
    }//GEN-LAST:event_jRadioButtDefaultReportDirectoryActionPerformed

    private void jRadioButtUserDefinedDirectoryActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jRadioButtUserDefinedDirectoryActionPerformed
        JRadioButton userDefinedButt = (JRadioButton) evt.getSource();

        boolean state = userDefinedButt.isSelected();

        this.jTextfieldUserDefinedDirectory.setEnabled(state);
        this.jButtonBrowseFileChooser.setEnabled(state);

        // the file chooser is not to present if there is already a 
        // directory path
        String currValue = jTextfieldUserDefinedDirectory.getText();

        if (currValue.equals(IdeProjectJacocoverageConfig.JACOCOVERAGE_DATA_ROOTDIR)) {
            this.jButtonBrowseFileChooserActionPerformed(evt);
        }

        storeOnAction();
    }//GEN-LAST:event_jRadioButtUserDefinedDirectoryActionPerformed

    private void timeStampedReportsActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_timeStampedReportsActionPerformed
        JCheckBox jChkboxTimeStamp = (JCheckBox) evt.getSource();

        boolean state = jChkboxTimeStamp.isSelected();
        jSpinnerRetainReports.setEnabled(state);

        storeOnAction();
    }//GEN-LAST:event_timeStampedReportsActionPerformed

    private void jSpinnerRetainReportsStateChanged(javax.swing.event.ChangeEvent evt) {//GEN-FIRST:event_jSpinnerRetainReportsStateChanged
        storeOnAction();
    }//GEN-LAST:event_jSpinnerRetainReportsStateChanged


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JButton jButtonBrowseFileChooser;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabelDefaultDir;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    public javax.swing.JRadioButton jRadioButtDefaultReportDirectory;
    public javax.swing.JRadioButton jRadioButtUserDefinedDirectory;
    public javax.swing.JSpinner jSpinnerRetainReports;
    public javax.swing.JTextField jTextfieldUserDefinedDirectory;
    public javax.swing.JCheckBox timeStampedReports;
    // End of variables declaration//GEN-END:variables
}
